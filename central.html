<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Central de Cursos</title>
  <link rel="stylesheet" href="css/stylecentral.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
</head>
<body>
  <div class="container">

  <div class="welcome" id="welcome-msg">
    <!-- O nome do usuário será inserido via JS -->
  </div>

  <!-- Avatar de Perfil -->
  <div id="perfil-icone" onclick="mostrarOpcoesAvatar()">
    <img id="avatar-img" src="img/img1.png" alt="Avatar" />
  </div>

  <div id="selecao-avatar" class="oculto">
      <!-- Avatares -->
      <img src="img/img1.png" class="avatar" onclick="selecionarAvatar('img/img1.png')">
<img src="img/img2.png" class="avatar" onclick="selecionarAvatar('img/img2.png')">
<img src="img/img3.png" class="avatar" onclick="selecionarAvatar('img/img3.png')">
<img src="img/img4.png" class="avatar" onclick="selecionarAvatar('img/img4.png')">
<img src="img/img5.png" class="avatar" onclick="selecionarAvatar('img/img5.png')">
<img src="img/img6.png" class="avatar" onclick="selecionarAvatar('img/img6.png')">
<img src="img/img7.png" class="avatar" onclick="selecionarAvatar('img/img7.png')">
<img src="img/img8.png" class="avatar" onclick="selecionarAvatar('img/img8.png')">
<img src="img/img9.png" class="avatar" onclick="selecionarAvatar('img/img9.png')">
<img src="img/img10.png" class="avatar" onclick="selecionarAvatar('img/img10.png')">
<img src="img/img11.png" class="avatar" onclick="selecionarAvatar('img/img11.png')">
<img src="img/img12.png" class="avatar" onclick="selecionarAvatar('img/img12.png')">

    </div>

    <!-- Hero -->
    <section class="hero">
      <h1>Central de Cursos</h1>
      <p>Desenvolva suas habilidades éticas corporativas com nossos módulos interativos</p>
    </section>

    <!-- Cursos -->
    <section class="course-grid">
      <div class="course-card">
        <span class="material-symbols-outlined">volunteer_activism</span>
        <h3 class="course-title">Empatia</h3>
        <p class="course-desc">Aprenda a se colocar no lugar do outro e fortalecer conexões no ambiente de trabalho.</p>
        <a href="ética.html" class="btn">Acessar Curso</a>
      </div>
      <div class="course-card">
        <span class="material-symbols-outlined">diversity_3</span>
        <h3 class="course-title">Trabalho em Equipe</h3>
        <p class="course-desc">Descubra técnicas para colaboração eficiente e alcance metas em conjunto.</p>
        <a href="curso2.html" class="btn">Acessar Curso</a>
      </div>
      <div class="course-card">
        <span class="material-symbols-outlined">neurology</span>
        <h3 class="course-title">Inteligência Emocional</h3>
        <p class="course-desc">Domine suas emoções e melhore a tomada de decisões em situações desafiadoras.</p>
        <a href="modulo1.html" class="btn">Acessar Curso</a>
      </div>
      <div class="course-card">
        <span class="material-symbols-outlined">record_voice_over</span>
        <h3 class="course-title">Comunicação</h3>
        <p class="course-desc">Aprimore suas habilidades de comunicação para transmitir mensagens claras e eficazes.</p>
        <a href="comunicação.html" class="btn">Acessar Curso</a>
      </div>
    </section>

    <!-- Estatísticas -->
    <section class="stats-section">
      <h2 class="stats-title">Sua Pontuação</h2>
      <div class="stats-chart">
        <canvas id="scoreChart"></canvas>
      </div>
    </section>

    <!-- Rodapé -->
    <footer>
      <button id="logout-btn" class="btn btn-logout-footer">Logout</button>
    </footer>
  </div>

  <script>
    if (!localStorage.getItem("usuario")) {
      window.location.href = "login.html";
    }

    const firebaseConfig = {
      apiKey: "AIzaSyAVZ-dvyJuGFF4fEHGjS-TrhzBmBslVwNs",
      authDomain: "curso-3-inteligencia-emocional.firebaseapp.com",
      projectId: "curso-3-inteligencia-emocional",
      storageBucket: "curso-3-inteligencia-emocional.appspot.com",
      messagingSenderId: "105031303963",
      appId: "1:105031303963:web:0ecdcddc91fbb0af69c9be"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const nomeUsuario = localStorage.getItem("usuario");

    async function carregarAvatar() {
      try {
        const snapshot = await db.collection("usuarios").where("nome", "==", nomeUsuario).limit(1).get();
        if (!snapshot.empty) {
          const avatar = snapshot.docs[0].data().avatar || 'img/img1.png';
          document.getElementById("avatar-img").src = avatar;
          localStorage.setItem('avatar', avatar);
        }
      } catch (e) {
        console.error("Erro ao carregar avatar:", e);
      }
    }
    carregarAvatar();

    function mostrarOpcoesAvatar() {
      document.getElementById("selecao-avatar").classList.toggle("oculto");
    }

    async function selecionarAvatar(src) {
      try {
        const snapshot = await db.collection("usuarios").where("nome", "==", nomeUsuario).limit(1).get();
        if (!snapshot.empty) {
          await snapshot.docs[0].ref.update({ avatar: src });
          document.getElementById("avatar-img").src = src;
          document.getElementById("selecao-avatar").classList.add("oculto");
          localStorage.setItem('avatar', src);
        }
      } catch (e) {
        console.error("Erro ao salvar avatar:", e);
        alert("Erro ao atualizar avatar.");
      }
    }

    function logoutHandler() {
      if (firebase.auth) {
        firebase.auth().signOut().then(() => {
          localStorage.clear();
          window.location.href = "login.html";
        }).catch((error) => {
          alert("Erro ao fazer logout: " + error.message);
        });
      } else {
        localStorage.clear();
        window.location.href = "login.html";
      }
    }

    document.getElementById('logout-btn').onclick = logoutHandler;

    // Gráfico de pontuação
    const scores = {
      empatia: parseInt(localStorage.getItem("score_empatia") || 0),
      equipe: parseInt(localStorage.getItem("score_equipe") || 0),
      emocional: parseInt(localStorage.getItem("score_emocional") || 0),
      comunicacao: parseInt(localStorage.getItem("score_comunicacao") || 0),
    };

    // Mensagem de boas-vindas
    document.getElementById('welcome-msg').innerHTML = `Bem-vindo(a), <strong>${nomeUsuario}</strong>!`;

    const ctx = document.getElementById('scoreChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Empatia', 'Trabalho em Equipe', 'Inteligência Emocional', 'Comunicação'],
        datasets: [{
          label: 'Pontuação Recorde',
          data: Object.values(scores),
          backgroundColor: '#00ff9c',
          borderColor: '#00ff9c',
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: { color: '#00ff9c' },
            grid: { color: '#00ff9c' }
          },
          x: {
            ticks: { color: '#00ff9c' },
            grid: { color: '#00ff9c' }
          }
        },
        plugins: {
          legend: { labels: { color: '#00ff9c' } }
        }
      }
    });
  </script>
</body>
</html>